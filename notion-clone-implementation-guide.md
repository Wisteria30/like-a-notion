# Notionã‚¯ãƒ­ãƒ¼ãƒ³ã‚¢ãƒ—ãƒª å®Œå…¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ã‚¸ãƒ¥ãƒ‹ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒNotionã®ã‚ˆã†ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’0ã‹ã‚‰æ§‹ç¯‰ã™ã‚‹ãŸã‚ã®åŒ…æ‹¬çš„ãªã‚¬ã‚¤ãƒ‰ã§ã™ã€‚AppFlowyã®å®Ÿè£…ã‚’å‚è€ƒã«ã€å¿…è¦ãªå…¨ã¦ã®è¦ç´ ã‚’è©³ç´°ã«èª¬æ˜ã—ã¾ã™ã€‚

## ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#2-æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](#3-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ)
4. [èªè¨¼ãƒ»æ¨©é™ç®¡ç†](#4-èªè¨¼æ¨©é™ç®¡ç†)
5. [ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¨ãƒ‡ã‚£ã‚¿](#5-ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¨ãƒ‡ã‚£ã‚¿)
6. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼](#6-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼)
7. [åŒæœŸãƒ»ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³](#7-åŒæœŸã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
8. [å®Ÿè£…æ‰‹é †](#8-å®Ÿè£…æ‰‹é †)
9. [ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ](#9-ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ)

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### 1.1 åŸºæœ¬è¦ä»¶
Notionã‚¯ãƒ­ãƒ¼ãƒ³ã‚¢ãƒ—ãƒªã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¨ãƒ‡ã‚£ã‚¿**: ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆç·¨é›†ã€ãƒ–ãƒ­ãƒƒã‚¯ãƒ™ãƒ¼ã‚¹ã®æ§‹é€ 
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: ãƒ†ãƒ¼ãƒ–ãƒ«ã€ã‚«ãƒ³ãƒãƒ³ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼
- **éšå±¤æ§‹é€ **: ãƒšãƒ¼ã‚¸ã®è¦ªå­é–¢ä¿‚ã€ç„¡é™ã®ãƒã‚¹ãƒˆ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒæ™‚ç·¨é›†
- **ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **æ¨©é™ç®¡ç†**: ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã€ãƒšãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

### 1.2 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‘ã‚¿ãƒ¼ãƒ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (Web/Mobile)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   UI    â”‚  â”‚  State   â”‚  â”‚  Local Storage   â”‚  â”‚
â”‚  â”‚ React/  â”‚  â”‚  Redux/  â”‚  â”‚  IndexedDB/      â”‚  â”‚
â”‚  â”‚ Flutter â”‚  â”‚  BLoC    â”‚  â”‚  SQLite          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚             â”‚                 â”‚
       â–¼             â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  REST    â”‚  â”‚ GraphQL  â”‚  â”‚   WebSocket     â”‚  â”‚
â”‚  â”‚  API     â”‚  â”‚   API    â”‚  â”‚   (Real-time)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚              â”‚                 â”‚
       â–¼              â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Backend Services                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Auth    â”‚  â”‚Document  â”‚  â”‚  Collaboration  â”‚  â”‚
â”‚  â”‚ Service  â”‚  â”‚ Service  â”‚  â”‚     Service     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Database  â”‚  â”‚  File    â”‚  â”‚    Search       â”‚  â”‚
â”‚  â”‚ Service  â”‚  â”‚ Storage  â”‚  â”‚    Service      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚PostgreSQLâ”‚  â”‚  Redis   â”‚  â”‚   S3/MinIO      â”‚  â”‚
â”‚  â”‚   JSONB  â”‚  â”‚  Cache   â”‚  â”‚  File Storage   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 2.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

**Webç‰ˆ**
```json
{
  "framework": "React 18+ ã¾ãŸã¯ Next.js 14+",
  "çŠ¶æ…‹ç®¡ç†": "Redux Toolkit + RTK Query",
  "ã‚¨ãƒ‡ã‚£ã‚¿": "Slate.js ã¾ãŸã¯ Lexical",
  "UI": "Tailwind CSS + Radix UI",
  "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ": "Socket.io-client",
  "ãƒ­ãƒ¼ã‚«ãƒ«DB": "IndexedDB (Dexie.js)",
  "CRDT": "Yjs"
}
```

**ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ**
```yaml
framework: Flutter 3.0+
çŠ¶æ…‹ç®¡ç†: flutter_bloc
ã‚¨ãƒ‡ã‚£ã‚¿: flutter_quill ã¾ãŸã¯ custom
ãƒ­ãƒ¼ã‚«ãƒ«DB: sqflite
åŒæœŸ: dio + web_socket_channel
```

### 2.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

```javascript
// Node.js/TypeScript ã‚¹ã‚¿ãƒƒã‚¯
{
  "ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯": "NestJS ã¾ãŸã¯ Express + TypeScript",
  "ORM": "Prisma ã¾ãŸã¯ TypeORM",
  "ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ": "Socket.io",
  "èªè¨¼": "Passport.js + JWT",
  "ã‚­ãƒ¥ãƒ¼": "Bull (Redis)",
  "æ¤œç´¢": "Elasticsearch ã¾ãŸã¯ MeiliSearch"
}

// ä»£æ›¿: Rust ã‚¹ã‚¿ãƒƒã‚¯ï¼ˆé«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼‰
{
  "ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯": "Actix-web ã¾ãŸã¯ Axum",
  "ORM": "Diesel ã¾ãŸã¯ SeaORM",
  "éåŒæœŸ": "Tokio",
  "WebSocket": "tokio-tungstenite"
}
```

### 2.3 ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£

```yaml
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:
  - PostgreSQL 14+ (ãƒ¡ã‚¤ãƒ³DB)
  - Redis (ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ã‚­ãƒ¥ãƒ¼)
  - Elasticsearch (å…¨æ–‡æ¤œç´¢)

ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸:
  - S3äº’æ›ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ (ç”»åƒã€ãƒ•ã‚¡ã‚¤ãƒ«)
  - CDN (CloudFront/Cloudflare)

ãƒ‡ãƒ—ãƒ­ã‚¤:
  - Docker + Kubernetes
  - ã¾ãŸã¯ Vercel/Railway (ç°¡æ˜“ç‰ˆ)
```

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 3.1 ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«

```sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    name VARCHAR(255) NOT NULL,
    avatar_url TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE workspaces (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(255) NOT NULL,
    icon TEXT,
    owner_id UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE workspace_members (
    workspace_id UUID REFERENCES workspaces(id),
    user_id UUID REFERENCES users(id),
    role VARCHAR(50) NOT NULL, -- 'owner', 'admin', 'member', 'guest'
    permissions JSONB DEFAULT '{}',
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (workspace_id, user_id)
);

-- ãƒ“ãƒ¥ãƒ¼ï¼ˆãƒšãƒ¼ã‚¸ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰
CREATE TABLE views (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    workspace_id UUID REFERENCES workspaces(id),
    parent_id UUID REFERENCES views(id),
    name VARCHAR(255) NOT NULL,
    icon TEXT,
    cover_url TEXT,
    layout VARCHAR(50) NOT NULL, -- 'document', 'grid', 'board', 'calendar', 'gallery'
    is_favorite BOOLEAN DEFAULT FALSE,
    is_archived BOOLEAN DEFAULT FALSE,
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP,
    -- éšå±¤æ§‹é€ ã®ãŸã‚ã®è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    path ltree, -- PostgreSQLæ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ç”¨
    sort_order INTEGER DEFAULT 0
);

-- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆCRDTå¯¾å¿œï¼‰
CREATE TABLE documents (
    view_id UUID PRIMARY KEY REFERENCES views(id),
    content JSONB NOT NULL, -- ãƒ–ãƒ­ãƒƒã‚¯æ§‹é€ ã®JSON
    text_content TEXT, -- æ¤œç´¢ç”¨ã®ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
    state_vector BYTEA, -- Yjs state vector
    update_seq BIGINT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°å±¥æ­´ï¼ˆCRDTï¼‰
CREATE TABLE document_updates (
    id BIGSERIAL PRIMARY KEY,
    document_id UUID REFERENCES documents(view_id),
    update_data BYTEA NOT NULL, -- Yjs update
    user_id UUID REFERENCES users(id),
    device_id VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ
CREATE TABLE database_schemas (
    view_id UUID PRIMARY KEY REFERENCES views(id),
    fields JSONB NOT NULL, -- ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å®šç¾©ã®é…åˆ—
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¡Œ
CREATE TABLE database_rows (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    view_id UUID REFERENCES views(id),
    cells JSONB NOT NULL, -- {field_id: value} ã®å½¢å¼
    created_by UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_views_workspace_parent ON views(workspace_id, parent_id);
CREATE INDEX idx_views_path ON views USING gist(path);
CREATE INDEX idx_documents_text ON documents USING gin(to_tsvector('english', text_content));
CREATE INDEX idx_database_rows_view ON database_rows(view_id) WHERE deleted_at IS NULL;
```

### 3.2 ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—ã®å®šç¾©

```typescript
// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å‹å®šç¾©
interface FieldType {
  id: string;
  name: string;
  type: 'text' | 'number' | 'select' | 'multiSelect' | 'date' | 
        'checkbox' | 'url' | 'email' | 'phone' | 'formula' | 
        'relation' | 'rollup' | 'createdTime' | 'createdBy' | 
        'lastEditedTime' | 'lastEditedBy' | 'files';
  options?: FieldOptions;
}

interface FieldOptions {
  // Select/MultiSelect
  choices?: Array<{
    id: string;
    name: string;
    color: string;
  }>;
  
  // Number
  format?: 'number' | 'currency' | 'percent';
  precision?: number;
  
  // Date
  dateFormat?: string;
  includeTime?: boolean;
  
  // Relation
  relationDatabaseId?: string;
  
  // Formula
  expression?: string;
}
```

## 4. èªè¨¼ãƒ»æ¨©é™ç®¡ç†

### 4.1 èªè¨¼ãƒ•ãƒ­ãƒ¼

```typescript
// JWTèªè¨¼ã®å®Ÿè£…ä¾‹
class AuthService {
  async signUp(data: SignUpDto): Promise<AuthResponse> {
    // 1. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    const validated = await this.validateSignUpData(data);
    
    // 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
    const hashedPassword = await bcrypt.hash(data.password, 10);
    const user = await this.userRepository.create({
      email: data.email,
      password: hashedPassword,
      name: data.name
    });
    
    // 3. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ä½œæˆ
    const workspace = await this.workspaceService.createDefault(user.id);
    
    // 4. ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ
    const tokens = this.generateTokens(user);
    
    // 5. ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜
    await this.saveSession(user.id, tokens.refreshToken);
    
    return {
      user: this.sanitizeUser(user),
      workspace,
      ...tokens
    };
  }

  generateTokens(user: User) {
    const payload = { sub: user.id, email: user.email };
    
    return {
      accessToken: this.jwt.sign(payload, { 
        expiresIn: '15m',
        secret: process.env.JWT_ACCESS_SECRET 
      }),
      refreshToken: this.jwt.sign(payload, { 
        expiresIn: '7d',
        secret: process.env.JWT_REFRESH_SECRET 
      })
    };
  }
}
```

### 4.2 æ¨©é™ç®¡ç†

```typescript
// æ¨©é™ãƒã‚§ãƒƒã‚¯ã®å®Ÿè£…
enum Permission {
  // ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãƒ¬ãƒ™ãƒ«
  WORKSPACE_VIEW = 'workspace:view',
  WORKSPACE_EDIT = 'workspace:edit',
  WORKSPACE_DELETE = 'workspace:delete',
  WORKSPACE_INVITE = 'workspace:invite',
  
  // ãƒ“ãƒ¥ãƒ¼ãƒ¬ãƒ™ãƒ«
  VIEW_CREATE = 'view:create',
  VIEW_READ = 'view:read',
  VIEW_UPDATE = 'view:update',
  VIEW_DELETE = 'view:delete',
  VIEW_SHARE = 'view:share'
}

class PermissionService {
  async checkPermission(
    userId: string,
    resourceId: string,
    permission: Permission
  ): Promise<boolean> {
    // 1. ãƒªã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—ã®ç‰¹å®š
    const resourceType = this.getResourceType(permission);
    
    // 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ãƒ¼ãƒ«å–å¾—
    const role = await this.getUserRole(userId, resourceId, resourceType);
    
    // 3. ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®æ¨©é™ãƒã‚§ãƒƒã‚¯
    return this.roleHasPermission(role, permission);
  }
  
  private rolePermissions = {
    owner: [Permission.WORKSPACE_VIEW, Permission.WORKSPACE_EDIT, 
            Permission.WORKSPACE_DELETE, Permission.WORKSPACE_INVITE,
            Permission.VIEW_CREATE, Permission.VIEW_READ, 
            Permission.VIEW_UPDATE, Permission.VIEW_DELETE, 
            Permission.VIEW_SHARE],
    admin: [Permission.WORKSPACE_VIEW, Permission.WORKSPACE_EDIT,
            Permission.WORKSPACE_INVITE, Permission.VIEW_CREATE,
            Permission.VIEW_READ, Permission.VIEW_UPDATE,
            Permission.VIEW_DELETE, Permission.VIEW_SHARE],
    member: [Permission.WORKSPACE_VIEW, Permission.VIEW_CREATE,
             Permission.VIEW_READ, Permission.VIEW_UPDATE],
    guest: [Permission.WORKSPACE_VIEW, Permission.VIEW_READ]
  };
}
```

## 5. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¨ãƒ‡ã‚£ã‚¿

### 5.1 ãƒ–ãƒ­ãƒƒã‚¯ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```typescript
// ãƒ–ãƒ­ãƒƒã‚¯ã®åŸºæœ¬æ§‹é€ 
interface Block {
  id: string;
  type: BlockType;
  content: BlockContent;
  children?: Block[];
  metadata?: BlockMetadata;
}

type BlockType = 
  | 'paragraph' 
  | 'heading_1' | 'heading_2' | 'heading_3'
  | 'bulleted_list_item' | 'numbered_list_item' | 'toggle_list_item'
  | 'to_do' | 'quote' | 'callout' | 'divider'
  | 'code' | 'image' | 'video' | 'file' | 'embed'
  | 'table' | 'column_list' | 'link_to_page'
  | 'synced_block' | 'template_button';

interface BlockContent {
  text?: RichText[];
  checked?: boolean;  // to-do
  language?: string;  // code block
  url?: string;       // image, video, embed
  caption?: RichText[];
}

interface RichText {
  type: 'text' | 'mention' | 'equation';
  text?: {
    content: string;
    link?: { url: string };
  };
  mention?: {
    type: 'user' | 'page' | 'database' | 'date';
    id?: string;
    user?: { id: string; name: string };
    page?: { id: string; title: string };
    date?: { start: string; end?: string };
  };
  equation?: {
    expression: string;
  };
  annotations?: {
    bold?: boolean;
    italic?: boolean;
    strikethrough?: boolean;
    underline?: boolean;
    code?: boolean;
    color?: string;
    background?: string;
  };
}
```

### 5.2 ã‚¨ãƒ‡ã‚£ã‚¿ã®å®Ÿè£…ï¼ˆReact + Slate.jsï¼‰

```tsx
// ã‚¨ãƒ‡ã‚£ã‚¿ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Ÿè£…ä¾‹
import { Slate, Editable, withReact, useSlate } from 'slate-react';
import { createEditor, Transforms, Editor, Node } from 'slate';
import { withHistory } from 'slate-history';

const NotionEditor: React.FC = () => {
  const [value, setValue] = useState<Node[]>(initialValue);
  const editor = useMemo(
    () => withPlugins(withHistory(withReact(createEditor()))),
    []
  );

  // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ 
  const withPlugins = (editor: Editor) => {
    const { isInline, isVoid, normalizeNode } = editor;

    // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è¦ç´ ã®å®šç¾©
    editor.isInline = (element) => {
      return ['mention', 'link'].includes(element.type) || isInline(element);
    };

    // Voidè¦ç´ ã®å®šç¾©
    editor.isVoid = (element) => {
      return ['image', 'video', 'divider'].includes(element.type) || isVoid(element);
    };

    // æ­£è¦åŒ–ãƒ«ãƒ¼ãƒ«
    editor.normalizeNode = (entry) => {
      const [node, path] = entry;

      // ãƒ–ãƒ­ãƒƒã‚¯ãƒ¬ãƒ™ãƒ«ã®æ­£è¦åŒ–
      if (Editor.isBlock(editor, node)) {
        // ç©ºã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’paragraphã«å¤‰æ›
        if (node.children.length === 0) {
          Transforms.setNodes(
            editor,
            { type: 'paragraph' },
            { at: path }
          );
        }
      }

      normalizeNode(entry);
    };

    return editor;
  };

  // ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè£…
  const handleSlashCommand = useCallback((search: string) => {
    const commands = [
      { title: 'Text', icon: 'ğŸ“', type: 'paragraph' },
      { title: 'Heading 1', icon: 'H1', type: 'heading_1' },
      { title: 'Heading 2', icon: 'H2', type: 'heading_2' },
      { title: 'Bulleted List', icon: 'â€¢', type: 'bulleted_list_item' },
      { title: 'Numbered List', icon: '1.', type: 'numbered_list_item' },
      { title: 'To-do List', icon: 'â˜', type: 'to_do' },
      { title: 'Toggle List', icon: 'â–¸', type: 'toggle_list_item' },
      { title: 'Quote', icon: '"', type: 'quote' },
      { title: 'Divider', icon: 'â€”', type: 'divider' },
      { title: 'Callout', icon: 'ğŸ’¡', type: 'callout' },
      { title: 'Code', icon: '</>', type: 'code' },
      { title: 'Image', icon: 'ğŸ–¼', type: 'image' }
    ];

    return commands.filter(cmd => 
      cmd.title.toLowerCase().includes(search.toLowerCase())
    );
  }, []);

  // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  const renderElement = useCallback((props: RenderElementProps) => {
    switch (props.element.type) {
      case 'heading_1':
        return <H1 {...props} />;
      case 'heading_2':
        return <H2 {...props} />;
      case 'paragraph':
        return <Paragraph {...props} />;
      case 'bulleted_list_item':
        return <BulletedListItem {...props} />;
      case 'numbered_list_item':
        return <NumberedListItem {...props} />;
      case 'to_do':
        return <TodoListItem {...props} />;
      case 'quote':
        return <Quote {...props} />;
      case 'code':
        return <CodeBlock {...props} />;
      case 'image':
        return <Image {...props} />;
      case 'divider':
        return <Divider {...props} />;
      default:
        return <Paragraph {...props} />;
    }
  }, []);

  const renderLeaf = useCallback((props: RenderLeafProps) => {
    return <Leaf {...props} />;
  }, []);

  return (
    <Slate editor={editor} value={value} onChange={setValue}>
      <Toolbar />
      <Editable
        renderElement={renderElement}
        renderLeaf={renderLeaf}
        placeholder="Type '/' for commands"
        onKeyDown={handleKeyDown}
      />
      {showSlashMenu && <SlashCommandMenu commands={slashCommands} />}
    </Slate>
  );
};
```

### 5.3 ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼ˆYjså®Ÿè£…ï¼‰

```typescript
// Yjsã‚’ä½¿ã£ãŸãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ
import * as Y from 'yjs';
import { WebsocketProvider } from 'y-websocket';
import { IndexeddbPersistence } from 'y-indexeddb';

class CollaborationService {
  private doc: Y.Doc;
  private provider: WebsocketProvider;
  private persistence: IndexeddbPersistence;

  constructor(documentId: string, userId: string) {
    // Yjsãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®åˆæœŸåŒ–
    this.doc = new Y.Doc();
    
    // ãƒ­ãƒ¼ã‚«ãƒ«æ°¸ç¶šåŒ–
    this.persistence = new IndexeddbPersistence(documentId, this.doc);
    
    // WebSocketæ¥ç¶š
    this.provider = new WebsocketProvider(
      process.env.REACT_APP_WS_URL!,
      documentId,
      this.doc,
      {
        params: { userId },
        WebSocketPolyfill: WebSocket
      }
    );

    // Awarenessï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹ï¼‰ã®è¨­å®š
    this.setupAwareness(userId);
  }

  setupAwareness(userId: string) {
    const awareness = this.provider.awareness;
    
    // è‡ªåˆ†ã®çŠ¶æ…‹ã‚’è¨­å®š
    awareness.setLocalState({
      userId,
      cursor: null,
      selection: null,
      user: {
        name: 'Current User',
        color: this.generateUserColor(userId)
      }
    });

    // ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çŠ¶æ…‹å¤‰æ›´ã‚’ç›£è¦–
    awareness.on('change', (changes: any) => {
      const states = awareness.getStates();
      this.updateRemoteCursors(states);
    });
  }

  // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹é€ ã®æ“ä½œ
  getSharedType() {
    return this.doc.getArray<Y.Map<any>>('blocks');
  }

  insertBlock(index: number, block: Block) {
    const yBlock = new Y.Map();
    Object.entries(block).forEach(([key, value]) => {
      yBlock.set(key, value);
    });
    
    this.doc.transact(() => {
      this.getSharedType().insert(index, [yBlock]);
    });
  }

  updateBlock(blockId: string, updates: Partial<Block>) {
    const blocks = this.getSharedType();
    const index = blocks.toArray().findIndex(
      b => b.get('id') === blockId
    );
    
    if (index >= 0) {
      this.doc.transact(() => {
        const block = blocks.get(index);
        Object.entries(updates).forEach(([key, value]) => {
          block.set(key, value);
        });
      });
    }
  }

  // å¤‰æ›´ã®ç›£è¦–
  observeChanges(callback: (event: Y.YArrayEvent<Y.Map<any>>) => void) {
    this.getSharedType().observe(callback);
  }

  destroy() {
    this.provider.destroy();
    this.persistence.destroy();
    this.doc.destroy();
  }
}
```

## 6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼

### 6.1 ã‚°ãƒªãƒƒãƒ‰ãƒ“ãƒ¥ãƒ¼ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

```tsx
// ã‚°ãƒªãƒƒãƒ‰ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
interface GridViewProps {
  databaseId: string;
  fields: Field[];
  rows: Row[];
  onCellEdit: (rowId: string, fieldId: string, value: any) => void;
}

const GridView: React.FC<GridViewProps> = ({ 
  databaseId, 
  fields, 
  rows, 
  onCellEdit 
}) => {
  const [sortConfig, setSortConfig] = useState<SortConfig[]>([]);
  const [filterConfig, setFilterConfig] = useState<FilterConfig[]>([]);
  const [selectedCells, setSelectedCells] = useState<Set<string>>(new Set());

  // ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã®å®Ÿè£…
  const rowVirtualizer = useVirtual({
    size: rows.length,
    parentRef: tableContainerRef,
    estimateSize: useCallback(() => 35, []),
    overscan: 10
  });

  // ã‚»ãƒ«ç·¨é›†ã®å‡¦ç†
  const handleCellEdit = useCallback((
    rowId: string, 
    fieldId: string, 
    value: any
  ) => {
    // æ¥½è¦³çš„æ›´æ–°
    updateLocalState(rowId, fieldId, value);
    
    // ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ï¼ˆãƒ‡ãƒã‚¦ãƒ³ã‚¹ä»˜ãï¼‰
    debouncedSave(rowId, fieldId, value);
  }, []);

  // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã”ã¨ã®ã‚»ãƒ«ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼
  const renderCell = (row: Row, field: Field) => {
    const value = row.cells[field.id];
    
    switch (field.type) {
      case 'text':
        return <TextCell value={value} onChange={handleCellEdit} />;
      case 'number':
        return <NumberCell value={value} field={field} onChange={handleCellEdit} />;
      case 'select':
        return <SelectCell value={value} options={field.options} onChange={handleCellEdit} />;
      case 'multiSelect':
        return <MultiSelectCell value={value} options={field.options} onChange={handleCellEdit} />;
      case 'date':
        return <DateCell value={value} onChange={handleCellEdit} />;
      case 'checkbox':
        return <CheckboxCell value={value} onChange={handleCellEdit} />;
      case 'relation':
        return <RelationCell value={value} field={field} onChange={handleCellEdit} />;
      default:
        return <TextCell value={value} onChange={handleCellEdit} />;
    }
  };

  return (
    <div className="grid-view">
      <div className="grid-header">
        {fields.map(field => (
          <GridHeaderCell 
            key={field.id}
            field={field}
            onSort={handleSort}
            onFilter={handleFilter}
            onResize={handleResize}
          />
        ))}
      </div>
      
      <div ref={tableContainerRef} className="grid-body">
        {rowVirtualizer.virtualItems.map(virtualRow => {
          const row = rows[virtualRow.index];
          return (
            <div 
              key={row.id}
              className="grid-row"
              style={{
                height: virtualRow.size,
                transform: `translateY(${virtualRow.start}px)`
              }}
            >
              {fields.map(field => (
                <div key={field.id} className="grid-cell">
                  {renderCell(row, field)}
                </div>
              ))}
            </div>
          );
        })}
      </div>
      
      <GridFooter 
        fields={fields}
        rows={rows}
        calculations={calculations}
      />
    </div>
  );
};
```

### 6.2 ã‚«ãƒ³ãƒãƒ³ãƒ“ãƒ¥ãƒ¼

```tsx
// ã‚«ãƒ³ãƒãƒ³ãƒ“ãƒ¥ãƒ¼ã®å®Ÿè£…
interface BoardViewProps {
  databaseId: string;
  groupField: Field;
  cards: Card[];
  onCardMove: (cardId: string, newGroupId: string) => void;
}

const BoardView: React.FC<BoardViewProps> = ({ 
  databaseId, 
  groupField, 
  cards, 
  onCardMove 
}) => {
  const [groups, setGroups] = useState<Group[]>([]);
  
  // ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã®è¨­å®š
  const onDragEnd = (result: DropResult) => {
    const { destination, source, draggableId } = result;
    
    if (!destination) return;
    
    if (
      destination.droppableId === source.droppableId &&
      destination.index === source.index
    ) {
      return;
    }

    // ã‚«ãƒ¼ãƒ‰ã®ç§»å‹•å‡¦ç†
    moveCard(
      draggableId,
      source.droppableId,
      destination.droppableId,
      source.index,
      destination.index
    );
  };

  return (
    <DragDropContext onDragEnd={onDragEnd}>
      <div className="board-view">
        {groups.map(group => (
          <BoardColumn
            key={group.id}
            group={group}
            cards={cards.filter(card => card.groupId === group.id)}
          />
        ))}
        
        <AddGroupButton onClick={handleAddGroup} />
      </div>
    </DragDropContext>
  );
};

const BoardColumn: React.FC<BoardColumnProps> = ({ group, cards }) => {
  return (
    <div className="board-column">
      <div className="column-header">
        <h3>{group.name}</h3>
        <span className="card-count">{cards.length}</span>
      </div>
      
      <Droppable droppableId={group.id}>
        {(provided, snapshot) => (
          <div
            ref={provided.innerRef}
            className={`column-cards ${
              snapshot.isDraggingOver ? 'dragging-over' : ''
            }`}
            {...provided.droppableProps}
          >
            {cards.map((card, index) => (
              <Draggable key={card.id} draggableId={card.id} index={index}>
                {(provided, snapshot) => (
                  <div
                    ref={provided.innerRef}
                    {...provided.draggableProps}
                    {...provided.dragHandleProps}
                    className={`board-card ${
                      snapshot.isDragging ? 'dragging' : ''
                    }`}
                  >
                    <BoardCard card={card} />
                  </div>
                )}
              </Draggable>
            ))}
            {provided.placeholder}
          </div>
        )}
      </Droppable>
      
      <AddCardButton groupId={group.id} />
    </div>
  );
};
```

### 6.3 ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼

```tsx
// ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ã®å®Ÿè£…
interface CalendarViewProps {
  databaseId: string;
  dateField: Field;
  events: CalendarEvent[];
  onEventMove: (eventId: string, newDate: Date) => void;
}

const CalendarView: React.FC<CalendarViewProps> = ({ 
  databaseId, 
  dateField, 
  events, 
  onEventMove 
}) => {
  const [currentDate, setCurrentDate] = useState(new Date());
  const [view, setView] = useState<'month' | 'week' | 'day'>('month');

  // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  const renderEvent = (event: CalendarEvent) => {
    return (
      <Draggable draggableId={event.id} index={0}>
        {(provided) => (
          <div
            ref={provided.innerRef}
            {...provided.draggableProps}
            {...provided.dragHandleProps}
            className="calendar-event"
            style={{
              backgroundColor: event.color,
              ...provided.draggableProps.style
            }}
          >
            <span className="event-title">{event.title}</span>
            <span className="event-time">{formatTime(event.start)}</span>
          </div>
        )}
      </Draggable>
    );
  };

  // æœˆè¡¨ç¤ºã®å®Ÿè£…
  const MonthView = () => {
    const weeks = getWeeksInMonth(currentDate);
    
    return (
      <div className="month-view">
        <div className="weekdays">
          {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
            <div key={day} className="weekday">{day}</div>
          ))}
        </div>
        
        {weeks.map((week, weekIndex) => (
          <div key={weekIndex} className="week">
            {week.map((day, dayIndex) => (
              <Droppable 
                key={`${weekIndex}-${dayIndex}`} 
                droppableId={day.toISOString()}
              >
                {(provided, snapshot) => (
                  <div
                    ref={provided.innerRef}
                    {...provided.droppableProps}
                    className={`day ${
                      !isSameMonth(day, currentDate) ? 'other-month' : ''
                    } ${isToday(day) ? 'today' : ''} ${
                      snapshot.isDraggingOver ? 'drag-over' : ''
                    }`}
                  >
                    <div className="day-number">{format(day, 'd')}</div>
                    <div className="day-events">
                      {getEventsForDay(events, day).map(event => 
                        renderEvent(event)
                      )}
                    </div>
                    {provided.placeholder}
                  </div>
                )}
              </Droppable>
            ))}
          </div>
        ))}
      </div>
    );
  };

  return (
    <DragDropContext onDragEnd={handleDragEnd}>
      <div className="calendar-view">
        <CalendarHeader 
          currentDate={currentDate}
          view={view}
          onNavigate={handleNavigate}
          onViewChange={setView}
        />
        
        {view === 'month' && <MonthView />}
        {view === 'week' && <WeekView />}
        {view === 'day' && <DayView />}
        
        <UnscheduledEvents 
          events={events.filter(e => !e.date)}
        />
      </div>
    </DragDropContext>
  );
};
```

## 7. åŒæœŸãƒ»ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### 7.1 CRDTãƒ™ãƒ¼ã‚¹ã®åŒæœŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```typescript
// åŒæœŸã‚µãƒ¼ãƒ“ã‚¹ã®å®Ÿè£…
class SyncService {
  private websocket: WebSocket;
  private syncQueue: SyncOperation[] = [];
  private isOnline: boolean = navigator.onLine;
  private retryCount: number = 0;

  constructor(private userId: string, private workspaceId: string) {
    this.setupWebSocket();
    this.setupOfflineHandling();
  }

  private setupWebSocket() {
    const wsUrl = `${process.env.REACT_APP_WS_URL}/sync`;
    this.websocket = new WebSocket(wsUrl);

    this.websocket.onopen = () => {
      console.log('WebSocket connected');
      this.authenticate();
      this.syncPendingOperations();
    };

    this.websocket.onmessage = (event) => {
      const message = JSON.parse(event.data);
      this.handleSyncMessage(message);
    };

    this.websocket.onerror = (error) => {
      console.error('WebSocket error:', error);
      this.handleConnectionError();
    };

    this.websocket.onclose = () => {
      console.log('WebSocket disconnected');
      this.scheduleReconnect();
    };
  }

  private authenticate() {
    this.send({
      type: 'auth',
      token: localStorage.getItem('accessToken'),
      workspaceId: this.workspaceId
    });
  }

  private handleSyncMessage(message: SyncMessage) {
    switch (message.type) {
      case 'state-vector':
        this.handleStateVector(message.data);
        break;
      case 'update':
        this.handleUpdate(message.data);
        break;
      case 'awareness':
        this.handleAwareness(message.data);
        break;
      case 'ack':
        this.handleAck(message.data);
        break;
      default:
        console.warn('Unknown message type:', message.type);
    }
  }

  // ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ
  private setupOfflineHandling() {
    window.addEventListener('online', () => {
      this.isOnline = true;
      this.reconnect();
    });

    window.addEventListener('offline', () => {
      this.isOnline = false;
    });
  }

  // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã®æ›´æ–°
  async applyLocalUpdate(
    objectId: string, 
    objectType: 'document' | 'database',
    update: Uint8Array
  ) {
    // 1. ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    await this.saveToLocalStorage(objectId, update);
    
    // 2. ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’æ›´æ–°
    this.applyUpdateToLocalState(objectId, update);
    
    // 3. åŒæœŸã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
    const operation: SyncOperation = {
      id: generateId(),
      objectId,
      objectType,
      update,
      timestamp: Date.now(),
      status: 'pending'
    };
    
    this.syncQueue.push(operation);
    
    // 4. ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãªã‚‰å³åº§ã«åŒæœŸ
    if (this.isOnline && this.websocket.readyState === WebSocket.OPEN) {
      this.syncOperation(operation);
    }
  }

  private async syncOperation(operation: SyncOperation) {
    try {
      this.send({
        type: 'update',
        objectId: operation.objectId,
        objectType: operation.objectType,
        update: Array.from(operation.update),
        operationId: operation.id
      });
      
      operation.status = 'syncing';
    } catch (error) {
      console.error('Sync error:', error);
      operation.status = 'failed';
      operation.retryCount = (operation.retryCount || 0) + 1;
    }
  }

  // ç«¶åˆè§£æ±º
  private async resolveConflict(
    localUpdate: Uint8Array,
    remoteUpdate: Uint8Array
  ): Promise<Uint8Array> {
    // Yjsã®CRDTç‰¹æ€§ã«ã‚ˆã‚Šè‡ªå‹•çš„ã«ç«¶åˆè§£æ±º
    const doc = new Y.Doc();
    Y.applyUpdate(doc, localUpdate);
    Y.applyUpdate(doc, remoteUpdate);
    return Y.encodeStateAsUpdate(doc);
  }
}
```

### 7.2 ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹æ©Ÿèƒ½

```typescript
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹ã®ç®¡ç†
interface UserPresence {
  userId: string;
  name: string;
  avatar?: string;
  color: string;
  cursor?: CursorPosition;
  selection?: Selection;
  status: 'active' | 'idle' | 'offline';
  lastSeen: Date;
}

class PresenceService {
  private awareness: awarenessProtocol.Awareness;
  private presenceMap: Map<string, UserPresence> = new Map();

  constructor(private doc: Y.Doc) {
    this.awareness = new awarenessProtocol.Awareness(doc);
    this.setupPresence();
  }

  private setupPresence() {
    // è‡ªåˆ†ã®ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹æƒ…å ±ã‚’è¨­å®š
    const localUser = this.getCurrentUser();
    this.awareness.setLocalState({
      user: {
        id: localUser.id,
        name: localUser.name,
        avatar: localUser.avatar,
        color: this.generateUserColor(localUser.id)
      },
      cursor: null,
      selection: null
    });

    // ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹å¤‰æ›´ã‚’ç›£è¦–
    this.awareness.on('change', ({ added, updated, removed }: any) => {
      const allClientIds = [...added, ...updated, ...removed];
      
      allClientIds.forEach(clientId => {
        const state = this.awareness.getStates().get(clientId);
        
        if (state) {
          this.updateUserPresence(clientId, state);
        } else {
          this.removeUserPresence(clientId);
        }
      });
      
      this.notifyPresenceChange();
    });
  }

  // ã‚«ãƒ¼ã‚½ãƒ«ä½ç½®ã®æ›´æ–°
  updateCursor(position: CursorPosition | null) {
    const currentState = this.awareness.getLocalState();
    this.awareness.setLocalState({
      ...currentState,
      cursor: position
    });
  }

  // é¸æŠç¯„å›²ã®æ›´æ–°
  updateSelection(selection: Selection | null) {
    const currentState = this.awareness.getLocalState();
    this.awareness.setLocalState({
      ...currentState,
      selection
    });
  }

  // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å–å¾—
  getActiveUsers(): UserPresence[] {
    return Array.from(this.presenceMap.values())
      .filter(user => user.status === 'active');
  }

  // ã‚«ãƒ¼ã‚½ãƒ«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç”¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  renderRemoteCursors() {
    return this.getActiveUsers()
      .filter(user => user.cursor)
      .map(user => (
        <RemoteCursor
          key={user.userId}
          position={user.cursor!}
          color={user.color}
          name={user.name}
        />
      ));
  }
}

// ãƒªãƒ¢ãƒ¼ãƒˆã‚«ãƒ¼ã‚½ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
const RemoteCursor: React.FC<{
  position: CursorPosition;
  color: string;
  name: string;
}> = ({ position, color, name }) => {
  return (
    <div
      className="remote-cursor"
      style={{
        left: position.x,
        top: position.y,
        borderColor: color
      }}
    >
      <div 
        className="cursor-label" 
        style={{ backgroundColor: color }}
      >
        {name}
      </div>
    </div>
  );
};
```

## 8. å®Ÿè£…æ‰‹é †

### 8.1 ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç›¤æ§‹ç¯‰ï¼ˆ1-2ãƒ¶æœˆï¼‰

1. **ç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
   ```bash
   # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
   npx create-nest-app notion-clone-api
   cd notion-clone-api
   npm install @prisma/client prisma bcrypt jsonwebtoken
   npm install @types/bcrypt @types/jsonwebtoken
   
   # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
   npx create-react-app notion-clone-web --template typescript
   cd notion-clone-web
   npm install slate slate-react yjs y-websocket
   npm install @dnd-kit/sortable @dnd-kit/core
   ```

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**
   ```bash
   npx prisma init
   # schema.prismaã‚’ç·¨é›†
   npx prisma migrate dev --name init
   ```

3. **èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…**
   - JWTèªè¨¼ã®åŸºæœ¬å®Ÿè£…
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²/ãƒ­ã‚°ã‚¤ãƒ³
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

4. **åŸºæœ¬çš„ãªãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ©Ÿèƒ½**
   - ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ä½œæˆ
   - ãƒ¡ãƒ³ãƒãƒ¼æ‹›å¾…
   - æ¨©é™ç®¡ç†

### 8.2 ãƒ•ã‚§ãƒ¼ã‚º2: ã‚³ã‚¢æ©Ÿèƒ½ï¼ˆ2-3ãƒ¶æœˆï¼‰

1. **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚¨ãƒ‡ã‚£ã‚¿**
   - ãƒ–ãƒ­ãƒƒã‚¯ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ‡ã‚£ã‚¿ã®åŸºæœ¬å®Ÿè£…
   - åŸºæœ¬çš„ãªãƒ–ãƒ­ãƒƒã‚¯ã‚¿ã‚¤ãƒ—ï¼ˆæ®µè½ã€è¦‹å‡ºã—ã€ãƒªã‚¹ãƒˆï¼‰
   - ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³è£…é£¾ï¼ˆå¤ªå­—ã€æ–œä½“ã€ä¸‹ç·šï¼‰
   - ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚³ãƒãƒ³ãƒ‰

2. **éšå±¤æ§‹é€ ã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**
   - ãƒšãƒ¼ã‚¸ãƒ„ãƒªãƒ¼ã®å®Ÿè£…
   - ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ã®ä¸¦ã¹æ›¿ãˆ
   - ãƒ‘ãƒ³ããšãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
   - ã‚µã‚¤ãƒ‰ãƒãƒ¼

3. **åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ©Ÿèƒ½**
   - ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ“ãƒ¥ãƒ¼ã®å®Ÿè£…
   - åŸºæœ¬çš„ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã€æ•°å€¤ã€é¸æŠï¼‰
   - ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚»ãƒ«ç·¨é›†

### 8.3 ãƒ•ã‚§ãƒ¼ã‚º3: é«˜åº¦ãªæ©Ÿèƒ½ï¼ˆ2-3ãƒ¶æœˆï¼‰

1. **é«˜åº¦ãªã‚¨ãƒ‡ã‚£ã‚¿æ©Ÿèƒ½**
   - ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆç”»åƒã€å‹•ç”»ï¼‰
   - ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼‰
   - æ•°å¼ãƒ–ãƒ­ãƒƒã‚¯
   - ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³

2. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ã®æ‹¡å¼µ**
   - ã‚«ãƒ³ãƒãƒ³ãƒ“ãƒ¥ãƒ¼
   - ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
   - é«˜åº¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—

3. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**
   - WebSocketæ¥ç¶šã®å®Ÿè£…
   - CRDTåŒæœŸ
   - ãƒ—ãƒ¬ã‚¼ãƒ³ã‚¹æ©Ÿèƒ½
   - ã‚«ãƒ¼ã‚½ãƒ«å…±æœ‰

### 8.4 ãƒ•ã‚§ãƒ¼ã‚º4: æœ€é©åŒ–ã¨æ‹¡å¼µï¼ˆ1-2ãƒ¶æœˆï¼‰

1. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**
   - ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
   - é…å»¶èª­ã¿è¾¼ã¿
   - ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥
   - ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºæœ€é©åŒ–

2. **æ¤œç´¢æ©Ÿèƒ½**
   - å…¨æ–‡æ¤œç´¢ã®å®Ÿè£…
   - ãƒ•ã‚¡ã‚¸ãƒ¼æ¤œç´¢
   - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨ãƒ•ã‚¡ã‚»ãƒƒãƒˆ

3. **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ/ã‚¤ãƒ³ãƒãƒ¼ãƒˆ**
   - Markdown ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   - PDF ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
   - ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

4. **ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ**
   - ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³
   - ã‚¿ãƒƒãƒæ“ä½œã®æœ€é©åŒ–
   - ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªï¼ˆFlutterï¼‰

## 9. ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### 9.1 DockeråŒ–

```dockerfile
# backend/Dockerfile
FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

FROM node:18-alpine
WORKDIR /app
COPY --from=builder /app/node_modules ./node_modules
COPY . .
RUN npx prisma generate
EXPOSE 3000
CMD ["node", "dist/main.js"]
```

```yaml
# docker-compose.yml
version: '3.8'
services:
  postgres:
    image: postgres:14-alpine
    environment:
      POSTGRES_USER: notion
      POSTGRES_PASSWORD: secret
      POSTGRES_DB: notion_clone
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

  backend:
    build: ./backend
    depends_on:
      - postgres
      - redis
    environment:
      DATABASE_URL: postgresql://notion:secret@postgres:5432/notion_clone
      REDIS_URL: redis://redis:6379
      JWT_SECRET: your-secret-key
    ports:
      - "3000:3000"

  frontend:
    build: ./frontend
    environment:
      REACT_APP_API_URL: http://localhost:3000
      REACT_APP_WS_URL: ws://localhost:3000
    ports:
      - "80:80"

volumes:
  postgres_data:
  redis_data:
```

### 9.2 Kubernetes ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: notion-clone-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: notion-clone-api
  template:
    metadata:
      labels:
        app: notion-clone-api
    spec:
      containers:
      - name: api
        image: your-registry/notion-clone-api:latest
        ports:
        - containerPort: 3000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
---
apiVersion: v1
kind: Service
metadata:
  name: notion-clone-api
spec:
  selector:
    app: notion-clone-api
  ports:
    - protocol: TCP
      port: 80
      targetPort: 3000
  type: LoadBalancer
```

### 9.3 ç›£è¦–ã¨ãƒ­ã‚®ãƒ³ã‚°

```typescript
// ç›£è¦–ã®å®Ÿè£…ä¾‹
import { PrometheusModule } from '@willsoto/nestjs-prometheus';
import { LoggerModule } from 'nestjs-pino';

@Module({
  imports: [
    PrometheusModule.register({
      defaultMetrics: {
        enabled: true,
      },
      controllers: true,
      providers: true,
    }),
    LoggerModule.forRoot({
      pinoHttp: {
        customProps: (req, res) => ({
          context: 'HTTP',
        }),
        transport: {
          target: 'pino-pretty',
          options: {
            singleLine: true,
          },
        },
      },
    }),
  ],
})
export class AppModule {}

// ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒˆãƒªã‚¯ã‚¹
@Injectable()
export class MetricsService {
  private readonly documentCreatedCounter = new Counter({
    name: 'documents_created_total',
    help: 'Total number of documents created',
    labelNames: ['workspace_id'],
  });

  private readonly apiResponseTime = new Histogram({
    name: 'api_response_time_seconds',
    help: 'API response time in seconds',
    labelNames: ['method', 'route', 'status'],
    buckets: [0.1, 0.5, 1, 2, 5],
  });

  recordDocumentCreated(workspaceId: string) {
    this.documentCreatedCounter.inc({ workspace_id: workspaceId });
  }

  recordApiResponseTime(method: string, route: string, status: number, duration: number) {
    this.apiResponseTime.observe({ method, route, status: status.toString() }, duration);
  }
}
```

## ã¾ã¨ã‚

ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦å®Ÿè£…ã™ã‚‹ã“ã¨ã§ã€Notionã®ã‚ˆã†ãªé«˜æ©Ÿèƒ½ãªã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ„ãƒ¼ãƒ«ã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚é‡è¦ãªãƒã‚¤ãƒ³ãƒˆï¼š

1. **ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚å®Œå…¨ã«å‹•ä½œã—ã€ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚ã«åŒæœŸ
2. **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: CRDTã«ã‚ˆã‚‹ç«¶åˆã®ãªã„åŒæ™‚ç·¨é›†
3. **æ‹¡å¼µå¯èƒ½ãªè¨­è¨ˆ**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚‹æ©Ÿèƒ½æ‹¡å¼µ
4. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«**: æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã«å¯¾å¿œã—ãŸè¨­è¨ˆ
5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ä»®æƒ³åŒ–ã¨é…å»¶èª­ã¿è¾¼ã¿ã«ã‚ˆã‚‹é«˜é€ŸåŒ–

æ®µéšçš„ã«å®Ÿè£…ã‚’é€²ã‚ã€å„ãƒ•ã‚§ãƒ¼ã‚ºã§ãƒ†ã‚¹ãƒˆã¨ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’é‡ã­ã‚‹ã“ã¨ãŒæˆåŠŸã®éµã§ã™ã€‚